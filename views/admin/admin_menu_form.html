{{ define "admin_menu_form.html" }}
{{ template "admin_header" . }}

<div class="max-w-4xl mx-auto mt-6">
    
    <div class="flex items-center gap-4 mb-6">
        <a href="/api/admin/menus" class="p-2 rounded-full hover:bg-gray-100 transition">
            <i data-lucide="arrow-left" class="w-6 h-6 text-gray-600"></i>
        </a>
        <h1 class="text-2xl font-bold text-sukatani-dark">{{ .Title }}</h1>
    </div>

    <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
        <div class="bg-sukatani-light px-6 py-4 border-b border-gray-200">
            <h2 class="font-semibold text-gray-800">Formulir Menu</h2>
        </div>

        <div class="p-6">
            <form 
                {{ if eq .Type "create" }}
                    action="/api/admin/menus" method="POST" enctype="multipart/form-data"
                {{ else }}
                    hx-put="/api/admin/menus/{{ .Data.ID }}" 
                    hx-encoding="multipart/form-data"
                    hx-swap="none"
                {{ end }}
                class="space-y-6"
            >
                <input type="hidden" name="csrf_token" value="{{ .csrf_token }}">
                {{ if .Error }}
                <div class="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg flex items-center gap-2">
                    <i data-lucide="alert-circle" class="w-5 h-5"></i>
                    <span>{{ .Error }}</span>
                </div>
                {{ end }}

                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    
                    <div class="space-y-5">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Nama Menu</label>
                            <input type="text" name="name" required 
                                   value="{{ if .Data }}{{ .Data.Name }}{{ end }}"
                                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sukatani-dark focus:border-transparent outline-none">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Harga</label>
                            <div class="relative">
                                <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-500 text-sm">Rp</span>
                                <input type="number" name="price" required 
                                       value="{{ if .Data }}{{ .Data.Price }}{{ end }}"
                                       class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sukatani-dark focus:border-transparent outline-none">
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Kategori</label>
                            <select name="category" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sukatani-dark bg-white">
                                <option value="makanan" {{ if .Data }}{{ if eq .Data.Category "makanan" }}selected{{ end }}{{ end }}>Makanan Berat</option>
                                <option value="minuman" {{ if .Data }}{{ if eq .Data.Category "minuman" }}selected{{ end }}{{ end }}>Minuman</option>
                                <option value="snack" {{ if .Data }}{{ if eq .Data.Category "snack" }}selected{{ end }}{{ end }}>Snack / Camilan</option>
                            </select>
                        </div>
                    </div>

                    <div class="space-y-5">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Pilih Booth</label>
                            <select name="booth_id" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sukatani-dark bg-white">
                                <option value="" disabled {{ if not .Data }}selected{{ end }}>-- Pilih Booth --</option>
                                {{ range .Booths }}
                                    <option value="{{ .ID }}" 
                                        {{ if $.Data }}
                                            {{ if eq $.Data.Booth.ID .ID }}selected{{ end }}
                                        {{ end }}
                                    >
                                        {{ .Name }}
                                    </option>
                                {{ end }}
                            </select>
                        </div>

                      <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Gambar Menu</label>
                        <div class="border-2 border-dashed border-gray-300 rounded-lg h-40 w-full relative hover:bg-gray-50 transition cursor-pointer overflow-hidden bg-white group">
                            
                            <input type="file" name="image" accept="image/*" onchange="previewImage(this)"
                                class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-20">
                            
                            <div id="upload-placeholder" 
                                class="absolute inset-0 flex flex-col items-center justify-center text-gray-500 z-10 
                                {{ if .Data }}{{ if .Data.ImagePath }}hidden{{ end }}{{ end }}">
                                
                                <i data-lucide="image-plus" class="w-8 h-8 mb-2 text-gray-400"></i>
                                <span class="text-xs">Klik untuk upload</span>
                            </div>

                            <img id="image-preview" 
                                src="{{ if .Data }}{{ .Data.ImagePath }}{{ end }}" 
                                class="absolute inset-0 w-full h-full object-cover z-10 
                                {{ if or (not .Data) (not .Data.ImagePath) }}hidden{{ end }}">
                                
                            <div id="hover-overlay" class="absolute inset-0 bg-black/50 z-10 hidden group-hover:flex items-center justify-center text-white font-medium pointer-events-none opacity-0 group-hover:opacity-100 transition">
                                Ganti Gambar
                            </div>
                        </div>
                     </div>

                        <div class="flex items-center pt-2">
                            <input type="checkbox" id="is_available" name="is_available" 
                                   {{ if .Data }}{{ if .Data.IsAvailable }}checked{{ end }}{{ else }}checked{{ end }}
                                   class="w-5 h-5 text-sukatani-dark rounded focus:ring-sukatani-dark cursor-pointer">
                            <label for="is_available" class="ml-2 text-sm font-medium text-gray-700 cursor-pointer">
                                Menu Tersedia (Stok Ada)
                            </label>
                        </div>
                    </div>
                </div>

                <div class="flex justify-end gap-3 pt-6 border-t border-gray-100 mt-4">
                    <a href="/api/admin/menus" class="px-6 py-2.5 text-sm font-medium text-gray-600 bg-white border border-gray-300 rounded-lg hover:bg-gray-50">
                        Batal
                    </a>
                    <button type="submit" class="px-6 py-2.5 text-sm font-medium text-white bg-sukatani-green rounded-lg hover:bg-opacity-90 flex items-center gap-2 shadow-sm">
                        <i data-lucide="save" class="w-4 h-4"></i>
                        Simpan Data
                    </button>
                </div>

            </form>
        </div>
    </div>
</div>

{{ if eq .Type "edit" }}
<script>
    document.body.addEventListener('htmx:afterRequest', function(evt) {
        if(evt.detail.successful) {
            window.location.href = "/api/admin/menus";
        } else {
            alert("Gagal update: " + (evt.detail.xhr.responseText || "Terjadi kesalahan"));
        }
    });
</script>
{{ end }}

<script>
    function previewImage(input) {
        const preview = document.getElementById('image-preview');
        const placeholder = document.getElementById('upload-placeholder');
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) {
                preview.src = e.target.result;
                preview.classList.remove('hidden');
                if(placeholder) placeholder.classList.add('hidden');
            }
            reader.readAsDataURL(input.files[0]);
        }
    }
</script>

{{ template "admin_footer" . }}
{{ end }}